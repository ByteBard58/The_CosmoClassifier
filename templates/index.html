<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">
    <meta charset="UTF-8">
    <title>The CosmoClassifier üåå</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
<div class="container">
    <h1>The CosmoClassifier ü™ê</h1>
    <p class="subtitle">Classify celestial objects (Galaxy, Star, Quasar) using SDSS data</p>

    <form id="predictForm">
        {% for col, label in zip(columns, labels) %}
            {% if col != 'class' %}
                <div class="input-group">
                    <label for="{{ col }}">{{ label }}</label>
                    <input type="number" id="{{ col }}" name="{{ col }}" placeholder="" step="any" inputmode="decimal">
                </div>
            {% endif %}
        {% endfor %}
        <button type="submit">Predict</button>
    </form>

    <div id="result" class="hidden">
        <h2>Prediction Result</h2>
        <p id="predClass"></p>
        <div id="probabilities"></div>
    </div>

    <footer>
        <p>
            Check the official GitHub repo for this web app
            <a href="https://github.com/ByteBard58/The_CosmoClassifier" target="_blank">here</a>.<br>
            The CosmoClassifier is licensed under the <strong>MIT License</strong>.<br>
            &copy; 2025 <strong>Sakib Hossain</strong>. All rights reserved.
        </p>
    </footer>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const form = document.getElementById("predictForm");
    const inputs = Array.from(form.querySelectorAll("input"));
    const resultDiv = document.getElementById("result");
    const predClass = document.getElementById("predClass");
    const probsDiv = document.getElementById("probabilities");

    // Move to next field on Enter
    inputs.forEach((input, index) => {
        input.addEventListener("keydown", (event) => {
            if (event.key === "Enter") {
                event.preventDefault();
                const next = inputs[index + 1];
                if (next) next.focus();
                else form.querySelector("button[type=submit]").focus();
            }
        });
    });

    form.addEventListener("submit", async (e) => {
        e.preventDefault();
        const formData = new FormData(form);
        const response = await fetch("/predict", { method: "POST", body: formData });
        const data = await response.json();

        predClass.innerHTML = `<b>Predicted Class:</b> ${data.prediction}`;
        probsDiv.innerHTML = "";
        for (const [cls, prob] of Object.entries(data.probabilities)) {
            probsDiv.innerHTML += `
                <div class="prob-row">
                    <span>${cls}</span>
                    <div class="bar">
                        <div class="fill" style="width: ${prob * 100}%"></div>
                    </div>
                    <span>${(prob * 100).toFixed(2)}%</span>
                </div>`;
        }

        resultDiv.classList.remove("hidden");
    });
});
</script>
</body>
</html>
